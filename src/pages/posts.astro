---
import { getCollection } from "astro:content";
import BlogPostModal from "../components/BlogPostModal.astro";
import BaseLayout from "../layouts/BaseLayout.astro";
const allPosts = await getCollection("blog");
const allSortedPosts = allPosts.sort(
	(b, a) =>
		new Date(a.data.eventDate).getTime() -
		new Date(b.data.eventDate).getTime(),
);
const columnConfig = [
	{ spacerClass: "h-25" },
	{ spacerClass: "h-15" },
	{ spacerClass: "h-5" },
	{ spacerClass: "h-15" },
];
const columns: {
	id: string;
	data: { title: string; thumbnail: string; tags: string[] };
}[][] = [[], [], [], []];
allSortedPosts.forEach((post: any, index: any) => {
	columns[index % 4].push(post);
});
const tags = [
	...new Set(allSortedPosts.map((post: any) => post.data.tags).flat()),
];
const getCoverType = (rowIndex: number, colIndex: number) => {
	return (rowIndex + colIndex) % 4;
};
const pageTitle = "Taksh's Notes";
---

<BaseLayout pageTitle={pageTitle}>
	<div class="grid grid-cols-[26%_47%_31%] h-screen relative notes-wrapper">
		<div class="border-r border-zinc-950 h-screen notes-left">
			<div
				class="flex border-b border-zinc-950 h-50 justify-start items-end"
			>
				<div class="flex flex-col justify-center items-center mb-5">
					<span class="tracking-wide text-xs opacity-80 ms-5"
						>_ _Short notes</span
					>
					<span class="tracking-wide text-xs opacity-80 ms-5"
						>and some pixels</span
					>
					<span class="tracking-wide text-xs opacity-80 ms-5"
						>of life_ _</span
					>
				</div>
			</div>
			<div
				class="flex flex-col p-6 gap-5 overflow-y-hidden max-h-[calc(100vh-200px)] border-b border-zinc-950"
			>
				<span class="font-semibold text-2xl">Tags</span>
				<div
					class="flex flex-wrap gap-2 w-full overflow-y-auto max-h-[calc(100vh-200px)] mb-5"
				>
					{
						tags.map((tag) => (
							<a
								href={`/tags/${tag}`}
								class="rounded w-fit px-3 py-2 cursor-pointer tag_button border"
							>
								{tag}
							</a>
						))
					}
				</div>
			</div>
		</div>
		<div
			class="border-r border-zinc-950 h-screen overflow-y-auto relative notes-main"
		>
			<div class="lg:grid grid-cols-4 h-full">
				{
					columns.map((column, colIndex) => (
						<div
							class={`${colIndex != 3 ? `lg:border-r border-zinc-950` : ``} lg:pt-20 `}
						>
							<div
								class={`hidden spacer_class sm:block border-b border-zinc-950 ${columnConfig[colIndex].spacerClass}`}
							/>

							{column.map((post: any, rowIndex: any) => {
								const coverType = getCoverType(
									rowIndex,
									colIndex,
								);
								return (
									<div class="cursor-pointer overflow-hidden border-b border-zinc-950">
										<div
											class="h-full cursor-pointer"
											onclick={`openBlogPostModal('${post.id}')`}
										>
											<div class="sm:h-45 flex items-center justify-center title-link">
												{coverType === 0 && (
													<h3 class="transition-transform duration-500 hover:scale-110 text-xl text-center uppercase m-auto mx-6 py-16 sm:py-0">
														{post.data.title}
													</h3>
												)}

												{coverType === 1 && (
													<div class="relative group">
														<img
															src={
																post.data
																	.thumbnail
															}
															alt={
																post.data.title
															}
															width="400"
															height="400"
															style="max-width: unset;"
															class="transition-transform duration-500 group-hover:scale-105"
														/>
														<div class="absolute inset-0 group-hover:bg-black/30 transition-colors duration-300" />
														<p class="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 text-xl bg_background p-3 max-w-[80%] sm:max-w-32.5 text-center border border-zinc-950 opacity-100 sm:opacity-0 sm:group-hover:opacity-100 transition-opacity duration-300">
															{post.data.title}
														</p>
													</div>
												)}

												{coverType === 2 && (
													<h3 class="transition-transform duration-500 hover:scale-107 txt_bg_clr text-xl text-center uppercase m-auto sm:mx-6 py-16 sm:py-0">
														{post.data.title}
													</h3>
												)}

												{coverType === 3 && (
													<div class="relative group w-full h-45 overflow-hidden">
														<img
															src={
																post.data
																	.thumbnail
															}
															alt={
																post.data.title
															}
															class="w-full h-full object-cover transition-transform duration-500 group-hover:scale-105"
															style="max-width: unset;"
														/>
														<div class="absolute inset-0 group-hover:bg-black/30 transition-colors duration-300" />
														<div class="absolute bottom-0 left-0 right-0 p-2 bg_background/80 backdrop-blur-xs">
															<h3 class="text-sm sm:text-base uppercase tracking-wide leading-snug text-white">
																{
																	post.data
																		.title
																}
															</h3>
														</div>
													</div>
												)}
											</div>
										</div>
									</div>
								);
							})}
						</div>
					))
				}
			</div>
		</div>
		<div
			class="border-r border-zinc-950 h-screen overflow-hidden notes-right"
		>
		</div>
	</div>
	<BlogPostModal posts={allSortedPosts} />
</BaseLayout>

<style>
	@media (max-width: 639px) {
		.notes-wrapper {
			display: flex;
			flex-direction: column;
			height: auto;
			padding: 5%;
		}

		.notes-left {
			display: block;
			height: auto;
			border-right: none;
		}

		.notes-right {
			display: none;
		}

		.notes-main {
			width: 100%;
			height: auto;
			border-right: none;
		}

		.notes-left > div {
			justify-content: center;
			align-items: center;
			height: 100%;
			padding: 6%;
		}

		.notes-left > div > div {
			flex-direction: row;
			gap: 0.4rem;
			margin-bottom: 0;
		}

		.notes-left span {
			margin-left: 0;
			white-space: nowrap;
		}
	}
	@media (max-width: 1024px) {
		.spacer_class {
			display: none;
		}
	}
</style>
